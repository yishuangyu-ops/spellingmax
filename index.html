<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ÊãºÂ≠óÂ≠∏ÁøíÊ©ü V3.5 (ÂàÜÁ¥ö‰øÆÂæ©Áâà)</title>
    
    <style>
        :root {
            --primary: #FFD54F; --primary-dark: #FFC107; --secondary: #4FC3F7; --secondary-dark: #039BE5;
            --accent: #FF7043; --bg: #FFF9C4; --text: #37474F; --white: #ffffff;
            --vowel: #E53935; --consonant: #1565C0; --success: #66BB6A; --error: #EF5350;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', 'ÂæÆËªüÊ≠£ÈªëÈ´î', sans-serif;
            background-color: var(--bg); color: var(--text); margin: 0; padding: 0;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
            overscroll-behavior-y: none;
        }

        /* Á¶ÅÊ≠¢ÈÅ∏Âèñ (Áî®ÊñºÊåâÈàï) */
        .noselect {
            -webkit-user-select: none; user-select: none;
        }

        /* Header */
        header {
            width: 100%; background: var(--primary); padding: 10px 15px;
            text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header-title { font-size: 1.2rem; font-weight: bold; color: #5D4037; flex-grow: 1; text-align: center; margin-left: 30px; }
        .setting-btn { background: none; border: none; font-size: 1.5rem; cursor: pointer; padding: 5px; }

        .controls-row { display: flex; justify-content: center; gap: 10px; width:100%; padding: 10px; background: #fff8e1;}
        select { padding: 8px 15px; border-radius: 20px; border: 2px solid #ddd; font-size: 1rem; background: white; outline: none; }

        /* Tabs */
        .tabs { display: flex; width: 95%; max-width: 600px; margin: 10px auto; background: rgba(255,255,255,0.7); border-radius: 30px; padding: 5px; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; font-weight: bold; font-size: 1rem; border-radius: 25px; color: #90A4AE; transition:0.2s; }
        .tab-btn.active { background: var(--secondary); color: white; box-shadow: 0 3px 6px rgba(3, 155, 229, 0.3); }

        /* Game Area */
        #game-area {
            width: 95%; max-width: 600px; background: white; border-radius: 25px; padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08); text-align: center; margin-bottom: 20px;
            min-height: 350px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative;
        }

        .big-word { font-size: 3rem; font-weight: bold; margin: 15px 0; letter-spacing: 1px; line-height: 1.2; word-break: break-word; }
        .vowel { color: var(--vowel); } .consonant { color: var(--consonant); }
        .syllable-display { font-size: 1.5rem; color: #90A4AE; margin-bottom: 5px; height: 30px; font-family: monospace; }
        
        .letter-slots { display: flex; flex-wrap: wrap; justify-content: center; gap: 6px; margin: 20px 0; min-height: 60px; }
        .slot { width: 40px; height: 45px; border-bottom: 4px solid #E0E0E0; display: flex; align-items: center; justify-content: center; font-size: 1.8rem; font-weight: bold; }
        .slot.filled { border-bottom-color: var(--secondary); transform: translateY(-2px); }
        .slot.space { border-bottom: none; width: 15px; }
        
        .scramble-area { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin-top: 10px; }
        
        .block-btn { 
            width: 50px; height: 50px; background: var(--primary); 
            border: none; border-radius: 12px; font-size: 1.6rem; font-weight: bold; 
            box-shadow: 0 4px 0 var(--primary-dark); cursor: pointer;
            touch-action: manipulation; transition: transform 0.1s, opacity 0.2s;
        }
        .block-btn:active { transform: translateY(4px); box-shadow: none; }
        .block-btn:disabled { opacity: 0; pointer-events: none; cursor: default; }
        
        .input-box { 
            font-size: 1.8rem; padding: 10px; width: 90%; text-align: center; 
            border: 3px solid var(--secondary); border-radius: 15px; outline: none; 
            margin: 20px 0; background: #FAFAFA; -webkit-user-select: text; user-select: text; 
        }
        .input-box:focus { border-color: var(--secondary-dark); background: #FFF; }
        
        .chinese { font-size: 1.5rem; margin-top: 5px; color: #546E7A; font-weight: bold; }
        .sentence { font-style: italic; color: #78909C; margin-top: 15px; font-size: 1rem; background: #ECEFF1; padding: 8px 15px; border-radius: 15px; display: inline-block; }
        
        .nav-controls { display: flex; justify-content: space-around; align-items: center; width: 100%; margin-top: auto; padding-top: 25px; }
        .action-btn { background: var(--accent); color: white; border: none; padding: 10px 24px; border-radius: 50px; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 0 #D84315; font-weight: bold; touch-action: manipulation; }
        .action-btn:active { transform: translateY(4px); box-shadow: none; }
        .speak-btn { width: 60px; height: 60px; border-radius: 50%; font-size: 26px; background: var(--secondary); box-shadow: 0 5px 0 #0288D1; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; color: white; touch-action: manipulation; }
        .speak-btn:active { transform: translateY(4px); box-shadow: none; }
        
        .feedback { font-size: 1.3rem; height: 30px; margin-bottom: 5px; font-weight: bold; }
        .progress-indicator { position: absolute; top: 15px; right: 20px; font-size: 0.9rem; color: #B0BEC5; font-weight: bold; }

        /* Settings Modal */
        #settings-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        .modal-content { background: white; width: 90%; max-width: 500px; padding: 20px; border-radius: 15px; max-height: 85vh; overflow-y: auto; text-align: left; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        textarea { width: 100%; height: 250px; border: 2px solid #eee; padding: 10px; font-family: monospace; font-size: 0.9rem; border-radius: 8px; resize: vertical; -webkit-user-select: text; user-select: text; }
        .modal-actions { text-align: right; margin-top: 15px; display: flex; justify-content: flex-end; gap: 10px; }
        
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }
        @keyframes pop { 50% {transform: scale(1.2);} }
        .anim-shake { animation: shake 0.4s; color: var(--error); }
        .anim-pop { animation: pop 0.3s; color: var(--success); }
        
        @media (max-width: 480px) { .big-word { font-size: 2.5rem; } }
    </style>
</head>
<body>

<header class="noselect">
    <div style="width:30px"></div>
    <div class="header-title">üêù Spelling Bee</div>
    <button class="setting-btn" onclick="openSettings()">‚öôÔ∏è</button>
</header>

<div class="controls-row noselect">
    <select id="levelSelect" onchange="changeLevel()"></select>
    <select id="voiceSelect" onchange="setVoice()"><option>Loading...</option></select>
</div>

<div class="tabs noselect">
    <button class="tab-btn active" onclick="switchMode('study')" id="tab-study">üëÄ Â≠∏Áøí</button>
    <button class="tab-btn" onclick="switchMode('block')" id="tab-block">üß© ÊãºÂúñ</button>
    <button class="tab-btn" onclick="switchMode('dictation')" id="tab-dictation">‚úçÔ∏è ËÅΩÂØ´</button>
</div>

<div id="game-area"></div>

<div id="settings-modal">
    <div class="modal-content">
        <h3 style="margin-top:0; color:var(--text)">üìù Á∑®ËºØÂñÆÂ≠óÂ∫´</h3>
        <p style="font-size:0.9rem; color:#666; background:#f5f5f5; padding:8px; border-radius:5px;">Ê†ºÂºèÔºöÂñÆÂ≠ó=Èü≥ÁØÄ=‰∏≠Êñá=‰æãÂè•</p>
        <textarea id="data-input"></textarea>
        <div class="modal-actions">
            <button class="action-btn" style="background:#B0BEC5" onclick="closeSettings()">ÂèñÊ∂à</button>
            <button class="action-btn" style="background:#FFB74D" onclick="resetDefault()">ÊÅ¢Âæ©È†êË®≠</button>
            <button class="action-btn" style="background:var(--success)" onclick="saveData()">üíæ ÂÑ≤Â≠ò</button>
        </div>
    </div>
</div>

<script>
    // ==========================================
    // 1. È†êË®≠Ë≥áÊñô
    // ==========================================
    const defaultDataRaw = `
attach=at-tach=ÈôÑ‰∏äÔºõË≤º‰∏ä=Please attach the photo to the email.
grunted=grunt-ed=ÁôºÂá∫ÂìºËÅ≤=The pig grunted while eating.
lumber=lum-ber=Êú®Êùê=They used lumber to build the house.
screwdriver=screw-driv-er=Ëû∫Áµ≤Ëµ∑Â≠ê=Use a screwdriver to fix the toy.
sneakers=sneak-ers=ÈÅãÂãïÈûã=I run fast in my new sneakers.
beneath=be-neath=Âú®...‰πã‰∏ã=The cat is sleeping beneath the table.
laces=la-ces=ÈûãÂ∏∂=Tie your shoe laces tight.
perfectly=per-fect-ly=ÂÆåÁæéÂú∞=The dress fits her perfectly.
shrunk=shrunk=Á∏ÆÊ∞¥(shrinkÁöÑÈÅéÂéªÂàÜË©û)=My shirt shrunk in the wash.
splinters=splin-ters=Á¢éÁâáÔºõÂà∫=Be careful of wood splinters.
board=board=ÊùøÂ≠êÔºõÊú®Êùø=Write your name on the board.
loosened=loos-ened=ËÆäÈ¨Ü=The knot loosened by itself.
roller skates=rol-ler-skates=Ê∫úÂÜ∞Èûã=She loves to wear roller skates.
skateboard=skate-board=ÊªëÊùø=He can do tricks on his skateboard.
travel=trav-el=ÊóÖË°å=We like to travel to Japan.
alley=al-ley=Â∞èÂ∑∑=The cat ran into the dark alley.
explore=ex-plore=Êé¢Á¥¢=Let's explore the forest.
pup=pup=Â∞èÁãó (Puppy)=The cute pup is playing with a ball.
collar=col-lar=È†ÖÂúà=The dog has a red collar.
furniture=fur-ni-ture=ÂÆ∂ÂÖ∑=We bought new furniture.
racket=rack-et=ÁêÉÊãç=I need a tennis racket.
crash=crash=ÊíûÊìäÔºõÂ¢úÊØÄ=We heard a loud car crash.
mover=mov-er=Êê¨ÂÆ∂Â∑•‰∫∫=The mover carried the heavy box.
track down=track-down=ËøΩËπ§Âà∞ÔºõÊâæÂà∞=The detective tried to track down the thief.
van=van=ÂªÇÂûãËªä=We moved our things in a big van.
exclaim=ex-claim=È©öÂè´ÔºõÂëºÂñä='Wow!' she exclaimed.
poke=poke=Êà≥=Don't poke the bear.
trouble=trou-ble=È∫ªÁÖ©=He got into trouble at school.
treats=treats=ÈªûÂøÉÔºõÊ¨æÂæÖ=I give my dog tasty treats.
train=train=ÁÅ´ËªäÔºõË®ìÁ∑¥=The train is arriving at the station.
unpack=un-pack=ÊâìÈñãÂåÖË£π=Let's unpack the boxes.
wag=wag=Êêñ (Â∞æÂ∑¥)=The dog wags its tail.
advice=ad-vice=Âª∫Ë≠∞=My teacher gave me good advice.
`;

    // ËÆäÊï∏
    let allWords = [];
    let currentLevelWords = [];
    let currentIndex = 0;
    let currentMode = 'study';
    let currentVoice = null;
    let isSyllableShown = false;
    const synth = window.speechSynthesis;
    const STORAGE_KEY = 'spelling_bee_v3_5_fix'; 

    window.onload = function() {
        loadData();
        initVoices();
    };

    function loadData() {
        let stored = localStorage.getItem(STORAGE_KEY);
        if (!stored || stored.trim() === '') stored = defaultDataRaw.trim();
        parseAndSetData(stored);
    }

    function parseAndSetData(text) {
        allWords = [];
        const lines = text.split('\n');
        lines.forEach(line => {
            if(line.trim() === '') return;
            const parts = line.split('=');
            if(parts.length >= 1) {
                const w = parts[0].trim();
                const s = parts[1]
